<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Providing Liquidity/1 Liquidity Providers _LPs_" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Liquidity Providers (LPs) | Drift Protocol</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://drift-labs.github.io/documentation-v2/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://drift-labs.github.io/documentation-v2/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://drift-labs.github.io/documentation-v2/docs/Providing Liquidity/-nUC-liquidity-providers-lps"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Liquidity Providers (LPs) | Drift Protocol"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/documentation-v2/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://drift-labs.github.io/documentation-v2/docs/Providing Liquidity/-nUC-liquidity-providers-lps"><link data-rh="true" rel="alternate" href="https://drift-labs.github.io/documentation-v2/docs/Providing Liquidity/-nUC-liquidity-providers-lps" hreflang="en"><link data-rh="true" rel="alternate" href="https://drift-labs.github.io/documentation-v2/docs/Providing Liquidity/-nUC-liquidity-providers-lps" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://CUKQY5DIF0-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/documentation-v2/blog/rss.xml" title="Drift Protocol RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation-v2/blog/atom.xml" title="Drift Protocol Atom Feed"><link rel="stylesheet" href="/documentation-v2/assets/css/styles.d53e7ed3.css">
<script src="/documentation-v2/assets/js/runtime~main.a5318732.js" defer="defer"></script>
<script src="/documentation-v2/assets/js/main.f09a6e30.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation-v2/"><div class="navbar__logo"><img src="/documentation-v2/img/logo.svg" alt="Drift Protocol logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation-v2/img/logo.svg" alt="Drift Protocol logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Drift Protocol v2</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/documentation-v2/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><div class="search navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://github.com/drift-labs/documentation-v2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Edit on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation-v2/docs/intro">Welcome to Drift Protocol</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/About Drift v2/OReT-understanding-drift-protocol">About Drift v2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Getting Started/NJ64-set-up-wallet-deposits-and-withdrawals">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Lend &amp; Borrow/DFvu-what-is-borrow-and-lend">Lend / Borrow</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Trading/UMHQ-how-to-trade-perpetual-swaps">Trading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/P&amp;L/CImq-pandl">P&amp;L</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Liquidations/uyaD-liquidations">Liquidations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Market Makers/JJR7-market-maker-participation">Market Makers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/documentation-v2/docs/Providing Liquidity/lhW0-liquidity-provision">Providing Liquidity</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation-v2/docs/Providing Liquidity/lhW0-liquidity-provision">DLP - Drift Liquidity Provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation-v2/docs/Providing Liquidity/-nUC-liquidity-providers-lps">Liquidity Providers (LPs)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation-v2/docs/Providing Liquidity/4EF9-liquidity-provision-faq">Liquidity Provision FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Insurance Fund/rUB3-insurance-fund">Insurance Fund</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Risk &amp; Safety/1v5N-delisting-process">Risk &amp; Safety</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Security/bpty-audits">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation-v2/docs/Guides/kFDd-api">Guides</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation-v2/docs/zh6h-glossary">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation-v2/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Providing Liquidity</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Liquidity Providers (LPs)</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Liquidity Providers (LPs)</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>Users can become a Liquidity Provider (LP) by allocating margin into any perpetual market offered by the vAMM. </p>
<p>By doing so, LPs increase the liquidity depth and collateralisation within the market and earn a rebate from taker fees.</p>
<p>LPs on Drift acquire opposing positions from new trades against the vAMM, regardless of the vAMM&#x27;s net position. As such, LPs are effectively investing in an active liquidity provision strategy on Drift&#x27;s vAMM. Once positions are settled for an individual LP, they will pay/earn the market&#x27;s funding rate.</p>
<p>Users are also able to LP with leverage.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="addingremoving-liquidity-">Adding/Removing Liquidity <a href="#addingremoving-liquidity-" class="hash-link" aria-label="Direct link to Adding/Removing Liquidity " title="Direct link to Adding/Removing Liquidity ">​</a></h3>
<p>When an LP adds liquidity to the vAMM, they increase the amount of liquidity on the AMM curve by increasing **k **in the constant product curve. </p>
<p>Specifically, <code>sqrt_k</code> is incremented by the number of <code>lp_shares</code> the LP takes on (<a href="https://github.com/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/lib.rs#L926-L933" target="_blank" rel="noopener noreferrer">code</a>) and so the proportion of liquidity provided to the vAMM is the ratio: <code>lp_shares / sqrt_k</code>. </p>
<p>This ratio is used throughout the code to calculate the amount of base/quote asset amounts to give to LPs. </p>
<p>Similarly, when an LP burns their <code>lp_shares</code>, k is decremented by the number of shares burned leading to a smaller k and more slippage for traders. In sufficiently large market imbalances, a user may be blocked from burning their LP shares.</p>
<p>Additionally when burning shares, if the unsettled position base amount is not a multiple of the market&#x27;s step size, the remainder amount is burned <strong>at cost</strong>. For instance, if the step size for SOL-PERP is .01, a remainder amount below this (say <code>.0099</code>) is charged by multiplying by the oracle price to the settled quote amount. This charge only occurs on burning shares, otherwise, with normal position settlement, remainder amounts will keep growing/shrinking and settlable once the total unsettled amount is a multiple of the step size.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trading-fees">Trading Fees<a href="#trading-fees" class="hash-link" aria-label="Direct link to Trading Fees" title="Direct link to Trading Fees">​</a></h3>
<p>80% of the taker fees collected by the vAMM are be given out to LPs. The disbursements are calculated as a percentage of the pro-rata liquidity provided to the vAMM. </p>
<p>For example, if the fee collected by the vAMM is 10 bps after filler rewards, and the vAMM was fully collateralised by LPs, then LPs would receive 8 bps out of the 10bps taker fee. If it was half collateralised by LPs, then LPs would receive  4 bps out of the 10bps taker fee (but also only half the opposing position).</p>
<p>This fee will be reflected in an improved cost basis of the positions acquired (<a href="https://github.com/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/controller/position.rs#L469" target="_blank" rel="noopener noreferrer">code</a>). </p>
<p>For example, if the LP received a 1 SOL short position with a cost basis of 100 USD and earned a 1 USD fee, then the LP&#x27;s final position would be a 1 SOL short with a cost basis of 101 USD* *(ie, the original position with a +1 USD P&amp;L incorporated).</p>
<p>Note that this fraction is a higher proportion than the active JIT maker rebate. </p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="margining">Margining<a href="#margining" class="hash-link" aria-label="Direct link to Margining" title="Direct link to Margining">​</a></h3>
<p>The amount of margin available for LPs is calculated as a combination of their current unsettled position and open orders (<a href="https://github.dev/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/math/margin.rs#L181-L208" target="_blank" rel="noopener noreferrer">code</a>). The LP&#x27;s unsettled position is treated as a regular market position without unrealized funding payments (see Funding section below) while the LP&#x27;s open orders are treated as normal open orders (i.e., taking the largest base asset amount that can be acquired through either the open asks or bids (<a href="https://github.com/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/state/user.rs#L237-L258" target="_blank" rel="noopener noreferrer">code</a>)). </p>
<p>The number of open bids/asks for an LP share is the amount of base asset amount it takes on if the base asset reserves reached either the lower or upper bound from its current value (<a href="https://github.dev/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/math/lp.rs#L120" target="_blank" rel="noopener noreferrer">code</a>). For example, if the current base asset reserves are 50 and the lower and upper bounds are 0 and 100 respectively, then the LP will have an equal amount of open bids and asks (ie, 50 open asks and 50 open bids when providing 100% of the liquidity). However, if the base asset reserves are 25 with the same bounds, then the LP will have more open asks than bids (ie, 75 open asks and 25 open bids when providing 100% of the liquidity) and so it will have a larger margin requirement than the first example (ie, 75 &gt; 50). For full examples, check out the margin tests <a href="https://github.dev/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/math/margin.rs#L789-L790" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>A user that decides to provide liquidity can opt to use leverage, similar to open orders. This puts them at increased risk of liquidation. Fortunately, a liquidation will remove their LP shares (to acquire more free margin) prior to liquidating any positions and applying larger penalties. This gives LP shares more leeway prior to liquidation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="funding">Funding<a href="#funding" class="hash-link" aria-label="Direct link to Funding" title="Direct link to Funding">​</a></h3>
<p>Users with LP shares who acquire positions through the vAMM acquire <strong>unsettled positions</strong>. Only once the positions are settled can they participate in funding payments. By default, the vAMM will act as the custodian of their position for funding payments prior to being settled. This means that LPs will need to be settled each funding period to earn their full funding payments.</p>
<p>LPs only earn funding on settled positions, to defend against malicious LPs and ensure all LPs earn the correct amount of funding.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-consideration--constraints">Design Consideration / Constraints<a href="#design-consideration--constraints" class="hash-link" aria-label="Direct link to Design Consideration / Constraints" title="Direct link to Design Consideration / Constraints">​</a></h3>
<p>At a high level, we track how much base/quote_asset_amount to give each lp by tracking a &quot;last_..._per_lp&quot; variable for both the base and quote amount when they first add liquidity (ie, <em>last</em>_base_asset_amount_per_lp and <em>last</em>_quote_asset_amount_per_lp respectively). For each trade that occurs on the protocol, the program updates these variables so the LPs get a slice of the opposite side of the trade (ie, if a trader opens a long then the base_asset_amount_per_lp variable would be decremented to track that the lp opens a short) (<a href="https://github.com/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/controller/position.rs#L433-L448" target="_blank" rel="noopener noreferrer">code</a>). To determine how much base/quote to give LPs when they burn their shares, the program takes the difference between the current per_lp values and the last per_lp values and multiply it by the number of shares they have (<a href="https://github.com/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/math/lp.rs#L62-L73" target="_blank" rel="noopener noreferrer">code</a>).</p>
<p>Following a similar pattern with the funding payments (eg, using a last_funding_payments_per_lp variable which is updated each time funding payments are distributed) would not work because the per_lp metrics can only tell you how much base asset amount the LPs have in total and not how much each LP has taken on individually. Following this pattern would enable an attack where a malicious LP adds a large amount of liquidity before the funding rate is updated and removes it right after the funding is updated, earning all of the funding payment without holding any base asset amount. The solution to this problem is to give unsettled positions to LPs which don&#x27;t earn funding until they call the <a href="https://github.com/drift-labs/protocol-v2/blob/190b042a4eeec8521aa6e9b54c094fbdea6a28d9/programs/clearing_house/src/lib.rs#L780" target="_blank" rel="noopener noreferrer">settle_lp function</a> and then calculate funding payments on these settled market positions like normal.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="protections">Protections<a href="#protections" class="hash-link" aria-label="Direct link to Protections" title="Direct link to Protections">​</a></h3>
<p>The vAMM has many protections against toxic flow which are implicitly applied to LPs (see <a href="/documentation-v2/docs/About Drift v2/VNtx-optimisations">Optimisations</a>). </p>
<p>Guards against botting activity aimed at taking advantage of auction order flow are also in place. These guards can be fine-tuned over time. </p>
<div><p>A brief cooldown period to burn LP shares (30 seconds since the last liquidity addition) is in place to prevent the potential atomic MEV capture of flow from the protocol/non-bot LPs.</p></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/drift-labs/documentation-v2/blob/master/docs/Providing Liquidity/1 Liquidity Providers _LPs_.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation-v2/docs/Providing Liquidity/lhW0-liquidity-provision"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DLP - Drift Liquidity Provider</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation-v2/docs/Providing Liquidity/4EF9-liquidity-provision-faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Liquidity Provision FAQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#addingremoving-liquidity-" class="table-of-contents__link toc-highlight">Adding/Removing Liquidity </a></li><li><a href="#trading-fees" class="table-of-contents__link toc-highlight">Trading Fees</a></li><li><a href="#margining" class="table-of-contents__link toc-highlight">Margining</a></li><li><a href="#funding" class="table-of-contents__link toc-highlight">Funding</a></li><li><a href="#design-consideration--constraints" class="table-of-contents__link toc-highlight">Design Consideration / Constraints</a></li><li><a href="#protections" class="table-of-contents__link toc-highlight">Protections</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/documentation-v2/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discordapp.com/invite/driftprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/orgs/drift-labs/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/driftprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://solana.stackexchange.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Solana Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/drift-labs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://drift-labs.github.io/v2-teacher/" target="_blank" rel="noopener noreferrer" class="footer__link-item">API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.drift.trade/stats" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">2024 Drift Protocol. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>