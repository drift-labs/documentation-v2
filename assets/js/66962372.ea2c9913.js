"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4147],{9349:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>c});var r=i(5893),t=i(1151);const s={title:"Drift AMM",slug:"NU41-drift-amm",createdAt:"Wed Jul 20 2022 10:15:24 GMT+0000 (Coordinated Universal Time)",updatedAt:"Tue Feb 21 2023 11:50:18 GMT+0000 (Coordinated Universal Time)"},a=void 0,d={id:"About Drift v2/1 Drift AMM",title:"Drift AMM",description:"Introduction&#x20;",source:"@site/docs/About Drift v2/1 Drift AMM.md",sourceDirName:"About Drift v2",slug:"/About Drift v2/NU41-drift-amm",permalink:"/documentation-v2/docs/About Drift v2/NU41-drift-amm",draft:!1,unlisted:!1,editUrl:"https://github.com/drift-labs/documentation-v2/blob/master/docs/About Drift v2/1 Drift AMM.md",tags:[],version:"current",frontMatter:{title:"Drift AMM",slug:"NU41-drift-amm",createdAt:"Wed Jul 20 2022 10:15:24 GMT+0000 (Coordinated Universal Time)",updatedAt:"Tue Feb 21 2023 11:50:18 GMT+0000 (Coordinated Universal Time)"},sidebar:"mySidebar",previous:{title:"Understanding Drift Protocol",permalink:"/documentation-v2/docs/About Drift v2/OReT-understanding-drift-protocol"},next:{title:"Decentralised Orderbook FAQ",permalink:"/documentation-v2/docs/About Drift v2/IvA9-decentralised-orderbook-faq"}},o={},c=[{value:"Introduction ",id:"introduction-",level:2},{value:"Drift v2 AMM ",id:"drift-v2-amm-",level:2},{value:"Inventory Adjusted Spreads",id:"inventory-adjusted-spreads",level:3},{value:"Oracle Live Pricing",id:"oracle-live-pricing",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"introduction-",children:"Introduction "}),"\n",(0,r.jsx)(n.p,{children:"Drift uses a backstop AMM as a source of guaranteed constant liquidity for the exchange, providing constant liquidity to be taken against asynchronously."}),"\n",(0,r.jsxs)(n.p,{children:["Drift's v1 featured a Dynamic AMM (DAMM) which was an iteration on top of Perpetual Protocol's innovation - the ",(0,r.jsx)(n.a,{href:"https://blog.perp.fi/a-deep-dive-into-our-virtual-amm-vamm-40345c522eeb",children:"virtual AMM (vAMM)"}),", except with configurable parameters, namely: "]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Peg:"})," a price multiplier"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"K:"})," liquidity depth"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fee Pool:"})," comprised of taker fee amounts (multiple methods for fee discounts to be implemented in the future)"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fee"})," ",(0,r.jsx)(n.strong,{children:"Tranches:"})," percentage allocations from the fee pool to be distributed amongst the following operations:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'Adjusting Peg (alternatively, "repeg")'}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"k"})," adjustments"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"(Capped) funding payments"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["You can read more about Drift's v1 DAMM design ",(0,r.jsx)(n.a,{href:"https://www.notion.so/driftprotocol/Drift-dAMM-deep-dive-ff154003aedb4efa83d6e7f4440cd4ab#861bdbceda8a45a38600a0d9d762ee25",children:"here"}),". "]}),"\n",(0,r.jsx)(n.h2,{id:"drift-v2-amm-",children:"Drift v2 AMM "}),"\n",(0,r.jsxs)(n.p,{children:["Drift\u2019s v2 AMM is still a vAMM using a constant product curve but now includes external ",(0,r.jsx)(n.a,{href:"/documentation-v2/docs/Providing%20Liquidity/-nUC-liquidity-providers-lps",children:"Liquidity Providers (LPs)"}),", a concentration factor, and dynamic spread/peg that ",(0,r.jsx)(n.strong,{children:"programmatically update prior to filling trades"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The mechanics behind the dynamic spread and peg are:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Inventory adjusted spreads"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Oracle live pricing/volatility"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"inventory-adjusted-spreads",children:"Inventory Adjusted Spreads"}),"\n",(0,r.jsx)(n.p,{children:"In a typical constant product AMM, the AMM quotes the same price for buys/sells and charges a flat fee. "}),"\n",(0,r.jsx)(n.p,{children:"To implicitly utilise a dynamic fee, Drift v2's AMM quotes different prices for buys and sells. The offset from the mid-price is dynamic based on the current inventory. "}),"\n",(0,r.jsx)(n.p,{children:"To do so, there will be 3 points tracked on the constant product curve: the bid price and ask price, and a point between the reservation price. "}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(5866).Z+"",width:"1180",height:"683"})}),"\n",(0,r.jsx)(n.p,{children:"Base long spread and short spread are currently set as: "}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"bid/ask price = reservation price \xb1 base_spread + f(inventory, balance, ...)"})," "]}),"\n",(0,r.jsx)(n.p,{children:"The long and short spread can be asymmetric due to changes in the underlying inventory skew and market buy/sell pressure. Ultimately, the ask - bid can never exceed the max spread (percentage calculated using the current valid oracle price). "}),"\n",(0,r.jsx)(n.p,{children:"The bid/ask points on the curve are calculated as follows (exact efficient integer math method calculated on contract): "}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"bid_quote_reserve = quote_reserve - (quote_reserve / (100%/short_spread))\nask_quote_reserve = quote_reserve + (quote_reserve / (100%/long_spread))"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"quote_reserve"})," is defined as the total AMM reserves of the quote asset. Then using the same k to back out the base_reserve for the bid/ask curves as well."]}),"\n",(0,r.jsx)(n.h3,{id:"oracle-live-pricing",children:"Oracle Live Pricing"}),"\n",(0,r.jsx)(n.p,{children:"The AMM's reservation price gets updated regularly through Drift's live oracle-based pricing. "}),"\n",(0,r.jsx)(n.p,{children:"This pricing mechanism updates an asset's mark price towards its oracle price, achieving:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"more accurate pricing; and"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"better entries and exits closer to oracle price. "}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The mark price is updated each time the oracle updates its price and when the contract is interacted with."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Oracle Live Pricing Sequence"})}),"\n",(0,r.jsxs)(n.p,{children:["Every time a trader wants to fill against the AMM, the AMM will be updated in the same slot with a valid oracle price (see ",(0,r.jsx)(n.a,{href:"/documentation-v2/docs/Trading/22EZ-oracles",children:"Oracles"}),").  "]}),"\n",(0,r.jsx)(n.p,{children:"The sequence is: "}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The AMM checks the oracle price"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The AMM move its peg toward the oracle price"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The AMM sets its bid/ask spread versus its reservation price"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The order will fill according to the bid/ask price if the order has lived longer than the minimum duration for AMM fills (10 slots)"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The overall spread will increase if the AMM is heavily levered or in debt. The oracle price and reservation price are always within this spread. Effective leverage is a function of many market stats, including Inventory P&L and collateral within the fee pool in the terminal state."}),"\n",(0,r.jsx)(n.p,{children:"The reservation (AMM) price is the ."})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},5866:(e,n,i)=>{i.d(n,{Z:()=>r});const r=i.p+"assets/images/K7PAJRkd_-P-t8v6RQ_nI_drift-amm-bid-ask-spreads-56f3c52d1c9663260413987c17028454.png"},1151:(e,n,i)=>{i.d(n,{Z:()=>d,a:()=>a});var r=i(7294);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);