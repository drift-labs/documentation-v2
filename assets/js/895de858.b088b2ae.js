"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2966],{5909:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var i=n(5893),r=n(1151);const a={title:"Tutorial- Arbitrage Bot",slug:"swMI-tutorial-arbitrage-bot",createdAt:"Mon Oct 11 2021 06:37:49 GMT+0000 (Coordinated Universal Time)",updatedAt:"Mon May 15 2023 12:16:32 GMT+0000 (Coordinated Universal Time)"},o=void 0,c={id:"Guides/Tutorial_ Arbitrage Bot",title:"Tutorial- Arbitrage Bot",description:"View Full GitHub example:",source:"@site/docs/Guides/Tutorial_ Arbitrage Bot.md",sourceDirName:"Guides",slug:"/Guides/swMI-tutorial-arbitrage-bot",permalink:"/documentation-v2/docs/Guides/swMI-tutorial-arbitrage-bot",draft:!1,unlisted:!1,editUrl:"https://github.com/drift-labs/documentation-v2/blob/master/docs/Guides/Tutorial_ Arbitrage Bot.md",tags:[],version:"current",frontMatter:{title:"Tutorial- Arbitrage Bot",slug:"swMI-tutorial-arbitrage-bot",createdAt:"Mon Oct 11 2021 06:37:49 GMT+0000 (Coordinated Universal Time)",updatedAt:"Mon May 15 2023 12:16:32 GMT+0000 (Coordinated Universal Time)"},sidebar:"mySidebar",previous:{title:"Troubleshooting",permalink:"/documentation-v2/docs/Guides/MNwd-troubleshooting"},next:{title:"Tutorial- Bots",permalink:"/documentation-v2/docs/Guides/gss4-tutorial-bots"}},s={},l=[{value:"View Full GitHub example:",id:"view-full-github-example",level:3},{value:"Getting Started",id:"getting-started",level:3},{value:"Advanced",id:"advanced",level:3}];function d(e){const t={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h3,{id:"view-full-github-example",children:"View Full GitHub example:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://github.com/drift-labs/example-bots/blob/master/src/arbitrage-bot.ts",children:"https://github.com/drift-labs/example-bots/blob/master/src/arbitrage-bot.ts"})}),"\n",(0,i.jsx)(t.h3,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsx)(t.p,{children:"1. Create a connection and wallet object. "}),"\n",(0,i.jsx)(t.p,{children:"It's important to safely load your private key outside of the code to ensure privacy."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:'import { Connection, Keypair, PublicKey } from "@solana/web3.js";\n\n// todo: rename to env variable with key\nconst privateKey = process.env.SOLANA_PRIVATE_KEY;\nconst keypair = Keypair.fromSecretKey(\n    Uint8Array.from(privateKey.split(",").map((val) => Number(val)))\n);\nconst wallet = new Wallet(keypair);\nconst connection = new Connection(endpoint);\n'})}),"\n",(0,i.jsx)(t.p,{children:"2. Install the @drift-labs/sdk. "}),"\n",(0,i.jsxs)(t.p,{children:["For more details, peek through ",(0,i.jsx)(t.a,{href:"/documentation-v2/docs/Guides/Qt1a-sdk-documentation",children:"SDK Documentation"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:'import {\n    convertToNumber,\n    DriftClient,\n    initialize,\n    PositionDirection,\n} from "@drift-labs/sdk";\n\nconst sdkConfig = initialize({ env: "mainnet-beta" });\nconst driftClientPublicKey = new PublicKey(sdkConfig.DRIFT_PROGRAM_ID);\n\nconst driftClient = DriftClient.from(connection, wallet, driftClientPublicKey);\n'})}),"\n",(0,i.jsx)(t.p,{children:"2. Initialize an account and deposit collateral (USDC) on Drift."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"[, userAccountPublicKey] =\n    await driftClient.initializeUserAccountAndDepositCollateral(\n        usdcAmount,\n        userUSDCAccount.publicKey\n    );\n"})}),"\n",(0,i.jsx)(t.p,{children:" 3. Pick a market and load the price. "}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"const marketIndex = new BN(0); // SOL\nmarkPrice = calculateMarkPrice(clearingHouse.getMarket(marketIndexBN));\nconsole.log(convertToNum(markPrice));\n"})}),"\n",(0,i.jsx)(t.p,{children:"4. Based on the current price, make a trade by passing a direction (LONG, SHORT) and size (USDC notional)."}),"\n",(0,i.jsxs)(t.p,{children:["Optionally: You can set a ",(0,i.jsx)(t.code,{children:"limitPrice"})," to place an Immediate or Cancel (IOC) order to help ensure your entryPrice comes as expected."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"const direction = PositionDirection.LONG(); // LONG\nconst amount = new BN(100000); // $1 (1e6 precision)\nconst limitPrice = markPrice.mul(1001).div(1000); // .1% tolerance (1e10 precision)\n\nawait clearingHouse.openPosition(direction, amount, marketIndex, limitPrice);\n"})}),"\n",(0,i.jsx)(t.h3,{id:"advanced",children:"Advanced"}),"\n",(0,i.jsx)(t.p,{children:"Take advantage of the SDK helpers that we've written for more measured trading:"}),"\n",(0,i.jsxs)(t.p,{children:["For instance,",(0,i.jsx)(t.code,{children:"calculateTargetPriceTrade"}),"calculate the liquidity available between the current markPrice to your targetPrice."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"This function is highly recommended for arbitrageurs."})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"const marketIndex = new BN(0);\nconst market = clearingHouse.getMarket(marketIndex);\nconst targetPrice = new BN(250.169 * MARK_PRICE_PRECISION);\n\nconst [direction, amount, entryPrice, newMarkPrice] = calculateTargetPriceTrade(\n    market,\n    targetPrice\n);\n\nawait clearingHouse.openPosition(direction, amount, marketIndex, entryPrice);\n"})})]})}function u(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>c,a:()=>o});var i=n(7294);const r={},a=i.createContext(r);function o(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);